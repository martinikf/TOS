@using Microsoft.AspNetCore.Mvc.TagHelpers
@using TOS.Data
@model IEnumerable<TOS.Models.Topic>

@{
    ViewData["Title"] = SharedLocalizer["Topic_Group_Heading"];
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>@SharedLocalizer["Topic_Group_Heading"]</h1>
<p>
    @if((User.IsInRole("Group") && User.Identity!.Name == (string)ViewData["creatorUsername"]!) || User.IsInRole("AnyGroup"))
    {
        <a class="btn btn-primary" asp-controller="Group" asp-action="Edit" asp-route-id="@ViewData["topicsIndexGroupId"]">@SharedLocalizer["Topic_Group_Edit"]</a>
    }
    @if (User.IsInRole("Topic") || User.IsInRole("AnyTopic"))
    {
        <a class="btn btn-primary" asp-action="Create" asp-route-groupName="@ViewData["topicsIndexGroupName"]" asp-route-type="Homework">@SharedLocalizer["Topic_Group_CreateHomework"]</a>
        <a class="btn btn-primary" asp-action="Create" asp-route-groupName="@ViewData["topicsIndexGroupName"]" asp-route-type="Project">@SharedLocalizer["Topic_Group_CreateProject"]</a>
    }
    @if (User.IsInRole("ProposeTopic"))
    {
        <a class="btn btn-primary" asp-action="Propose" asp-route-groupName="@ViewData["topicsIndexGroupName"]" asp-route-type="Project">@SharedLocalizer["Topic_Group_ProposeProject"]</a>
    }
</p>

<form asp-action="Group" method="get">
    <input type="hidden" name="groupName" value="@ViewData["topicsIndexGroupId"]"/>
    <div class="row g-1 align-items-center">
        <div class="col-auto">
            <input type="text" class="form-control" name="searchString" placeholder="Search string..." value="@ViewData["searchString"]"/>
        </div>

        <div class="form-check col-auto">
            <label for="showTaken">@SharedLocalizer["Topic_Index_ShowTaken"]</label>
            @if ((bool) ViewData["showTakenTopics"]!)
            {
                <input class="form-check-input" name="showTakenTopics" id="showTaken" type="checkbox" value="true" checked/>
            }
            else
            {
                <input class="form-check-input" name="showTakenTopics" id="showTaken" type="checkbox" value="true"/>
            }
        </div>

        <div class="col-auto">
            <input type="submit" class="btn btn-primary" value="@SharedLocalizer["Topic_Index_Search"]"/>
        </div>

    </div>

    @if (User.IsInRole("Topic") || User.IsInRole("AnyTopic"))
     {
         <div class="row g-3 align-items-center mx-auto">
             <div class="col-auto form-check">
                 <label for="showHidden">@SharedLocalizer["Topic_Index_ShowHidden"]</label>
                 @if ((bool) ViewData["showHidden"]!)
                 {
                     <input class="form-check-input" name="showHidden" id="showHidden" type="checkbox" value="true" checked/>
                 }
                 else
                 {
                     <input class="form-check-input" name="showHidden" id="showHidden" type="checkbox" value="true"/>
                 }
             </div>

             <div class="col-auto form-check">
                 <label for="showProposed">@SharedLocalizer["Topic_Index_ShowProposedOnly"]</label>
                 @if ((bool) ViewData["showProposed"]!)
                 {
                     <input class="form-check-input" name="showProposed" id="showProposed" type="checkbox" value="true" checked/>
                 }
                 else
                 {
                     <input class="form-check-input" name="showProposed" id="showProposed" type="checkbox" value="true"/>
                 }
             </div>
         </div>
     }
</form>

<hr/>
@if (Model.Any(x => x.Type == TopicType.Homework))
{
    <h2 class="h3">Homeworks</h2>

    @foreach (var hw in Model.Where(x => x.Type == TopicType.Homework))
    {
       <partial name="HomeworkPreview" model="hw"/>
    }
}

@if (Model.Any(x => x.Type == TopicType.Project))
{
    <h2 class="h3">Projects</h2>
    @foreach (var project in Model.Where(x => x.Type == TopicType.Project))
    {
        <partial name="ProjectPreview" model="project"/>
    }
}